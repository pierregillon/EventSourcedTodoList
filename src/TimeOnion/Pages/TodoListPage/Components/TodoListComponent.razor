@using TimeOnion.Domain.Todo.UseCases
@using TimeOnion.Pages.TodayTaskPreparation
@using TimeOnion.Domain.Todo.Core
@inherits BlazorState.BlazorStateComponent

@if (TodoList is not null)
{
    <div class="todolist">

        <div class="todolist-actions">
            <MudTextField
                T="string"
                InputMode="InputMode.text"
                Text="@TodoList.Name"
                TextChanged="newName => Rename(TodoList.Id, newName)"
                TextUpdateSuppression="false"
                DebounceInterval="1000"
                Class="compact title"
                DisableUnderLine="true">
            </MudTextField>

            <MudTooltip Text="Créer une catégorie">
                <MudIconButton
                    Class="action-button"
                    Icon="@Icons.Material.Filled.CreateNewFolder"
                    Color="Color.Primary"
                    OnClick="() => CreateNewCategory(TodoList.Id)">
                </MudIconButton>
            </MudTooltip>

            <MudTooltip Text="Supprimer la liste">
                <MudIconButton
                    Class="action-button"
                    Icon="@Icons.Material.Filled.Delete"
                    Color="Color.Error"
                    OnClick="() => Delete(TodoList.Id)">
                </MudIconButton>
            </MudTooltip>
        </div>

        <MudDivider Class="medium"/>

        <TodoItemsComponent TodoListId="@TodoList.Id"></TodoItemsComponent>
    </div>
}

<style>
    .fake.mud-input-control.mud-input-control-boolean-input {
        margin-left: 26px;
    }
    
    .todolist {
        flex-grow: 1;
        max-width: 600px;
    }
    
    .title .mud-input > input {
        font-size: 30px;
    }
    
    .todolist-actions {
         display: flex;
         align-items: self-end;
         justify-content: center;
         gap: 20px;
     }
     
     .action-button {
        opacity: 0;
     }
     
     .todolist-actions:hover .action-button {
        opacity: 1;
     }
</style>

@code {

    [Parameter]
    public TodoListReadModel? TodoList { get; set; }

    private async Task AddItemToDo(TodoListId listId, string itemDescription)
        => await Mediator.Send(new TodoListState.AddNewItem(listId, itemDescription));

    private async Task Rename(TodoListId listId, string newName)
        => await Mediator.Send(new TodoListState.RenameTodoList(listId, newName));

    private async Task CreateNewCategory(TodoListId listId)
        => await Mediator.Send(new TodoListState.CreateNewCategory(listId, "Nouvelle catégorie"));

    private async Task Delete(TodoListId listId)
        => await Mediator.Send(new TodoListState.DeleteTodoList(listId));

}